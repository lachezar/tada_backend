this.JST=this.JST||{},function(){var t,e,n,i,r,o={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a=function(t,e){return function(){return t.apply(e,arguments)}};n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.defaults=function(){return{title:"...",next_id:null,done:!1}},e.prototype.toggle=function(){return this.save({done:!this.get("done")})},e}(Backbone.Model),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.model=n,e.prototype.url="/api/task",e.prototype.parse=function(t){return t.objects},e.prototype.done=function(){return this.where({done:!0})},e.prototype.remaining=function(){return this.without.apply(this,this.done())},e.prototype.comparator="next_id",e}(Backbone.Collection),r=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.prototype.tagName="li",n.prototype.template=Mustache.compile($("#task-template").html()),n.prototype.events={"click .toggle":"toggleDone","click .title":"edit","keypress .edit":"updateOnEnter","blur .edit":"close"},n.prototype.initialize=function(){return this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"change:id",this.changeAndSort),this.listenTo(this.model,"destroy",this.removeAndSort)},n.prototype.render=function(){return this.$el.html(this.template(this.model.toJSON())),this.$el.toggleClass("done",this.model.get("done")),this.input=this.$(".edit"),this},n.prototype.changeAndSort=function(){return this.el.dataset.id=this.model.id,t.vent.trigger("sort")},n.prototype.removeAndSort=function(){return this.remove(),t.vent.trigger("sort")},n.prototype.toggleDone=function(){return this.model.toggle()},n.prototype.edit=function(){return this.$el.addClass("editing"),this.input.focus()},n.prototype.close=function(){var t;return t=this.input.val(),t?(t!==this.model.get("title")&&this.model.save({title:t}),this.$el.removeClass("editing")):this.clear()},n.prototype.updateOnEnter=function(t){return 13===t.keyCode?this.close():void 0},n.prototype.clear=function(){return this.model.destroy()},n}(Backbone.View),e=function(t){function e(){return this.sort=a(this.sort,this),e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.el=$(".container"),e.prototype.events={"keypress #new-todo":"createNewTask","click .add-button":"createNewTask","click #complete-all-checkbox":"completeAllTasks"},e.prototype.vent=_.extend({},Backbone.Events),e.prototype.initialize=function(){return this.tasks=new i,this.input=this.$("#new-todo"),this.completeAll=this.$("#complete-all"),this.remaining=this.$("#complete-all .remaining"),this.listenTo(this.tasks,"add",this.addOne),this.listenTo(this.tasks,"reset",this.addAll),this.listenTo(this.tasks,"all",this.render),this.footer=this.$("footer"),this.main=this.$("#main"),this.tasks.reset(preloadedTasks),this.$("#task-list").sortable({handle:".draggable",stop:this.sort,cursor:"move",items:">li[data-id]"}),this.$("#task-list").disableSelection(),this.vent.on("sort",this.sort,this)},e.prototype.render=function(){var t;return t=this.tasks.remaining().length,t>1?(this.remaining.html(t),this.completeAll.show()):this.completeAll.hide()},e.prototype.addOne=function(t){var e,n=this;return e=new r({model:t}),this.$("#task-list").append(e.render().el),this.completeAll.insertAfter("#task-list li:last"),setTimeout(function(){return n.$("#task-list").sortable("refresh")},500)},e.prototype.addPreloaded=function(t){var e;return e=new r({model:t,el:this.$("li[data-id="+t.id+"]")}),e.input=this.$("li[data-id="+t.id+"] .edit")},e.prototype.addAll=function(){return this.tasks.each(this.addPreloaded,this)},e.prototype.createNewTask=function(t){return t.keyCode>=0&&13!==t.keyCode||!this.input.val()?void 0:(this.tasks.create({title:this.input.val()}),this.input.val(""))},e.prototype.completeAllTasks=function(){var t=this;return $.ajax("/api/task/complete-all",{type:"PATCH"}).then(function(){return t.$("#complete-all :checkbox").removeAttr("checked"),t.tasks.each(function(t){return t.set({done:!0})})})},e.prototype.sort=function(){var t,e,n,i,r,o;for(e=$("#task-list").sortable("toArray",{attribute:"data-id"}),n=this.tasks.get(e[0]),o=e.slice(1),i=0,r=o.length;r>i;i++)t=o[i],n.get("next_id")!==+t&&n.save({next_id:t}),n=this.tasks.get(t);return n&&null!==n.get("next_id")?n.save({next_id:null}):void 0},e}(Backbone.View),t=new e}.call(this);